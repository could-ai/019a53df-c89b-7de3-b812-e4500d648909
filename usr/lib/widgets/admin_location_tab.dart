import 'package:flutter/material.dart';\nimport '../services/location_service.dart';\nimport '../models/location.dart';\n\nclass AdminLocationTab extends StatefulWidget {\n  final LocationService locationService;\n\n  const AdminLocationTab({super.key, required this.locationService});\n\n  @override\n  State<AdminLocationTab> createState() => _AdminLocationTabState();\n}\n\nclass _AdminLocationTabState extends State<AdminLocationTab> {\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      body: ListView.builder(\n        padding: const EdgeInsets.all(16),\n        itemCount: widget.locationService.locations.length,\n        itemBuilder: (context, index) {\n          final location = widget.locationService.locations[index];\n          return Card(\n            margin: const EdgeInsets.only(bottom: 12),\n            child: ListTile(\n              leading: Icon(\n                location.isBlocked ? Icons.block : Icons.location_on,\n                color: location.isBlocked ? Colors.red : Colors.green,\n                size: 32,\n              ),\n              title: Text(\n                location.name,\n                style: const TextStyle(fontWeight: FontWeight.bold),\n              ),\n              subtitle: Column(\n                crossAxisAlignment: CrossAxisAlignment.start,\n                children: [\n                  Text(location.address),\n                  if (location.isBlocked) ..[\n                    const SizedBox(height: 4),\n                    Text(\n                      'Blocked: ${location.blockedReason}',\n                      style: const TextStyle(\n                        color: Colors.red,\n                        fontStyle: FontStyle.italic,\n                      ),\n                    ),\n                  ],\n                ],\n              ),\n              trailing: PopupMenuButton(\n                itemBuilder: (context) => [\n                  PopupMenuItem(\n                    child: ListTile(\n                      leading: Icon(\n                        location.isBlocked ? Icons.check_circle : Icons.block,\n                      ),\n                      title: Text(location.isBlocked ? 'Unblock' : 'Block'),\n                      contentPadding: EdgeInsets.zero,\n                    ),\n                    onTap: () {\n                      Future.delayed(const Duration(milliseconds: 100), () {\n                        if (location.isBlocked) {\n                          setState(() {\n                            widget.locationService.unblockLocation(location.id);\n                          });\n                        } else {\n                          _showBlockDialog(location);\n                        }\n                      });\n                    },\n                  ),\n                  PopupMenuItem(\n                    child: const ListTile(\n                      leading: Icon(Icons.edit),\n                      title: Text('Edit'),\n                      contentPadding: EdgeInsets.zero,\n                    ),\n                    onTap: () {\n                      Future.delayed(const Duration(milliseconds: 100), () {\n                        _showEditDialog(location);\n                      });\n                    },\n                  ),\n                  PopupMenuItem(\n                    child: const ListTile(\n                      leading: Icon(Icons.delete, color: Colors.red),\n                      title: Text('Delete', style: TextStyle(color: Colors.red)),\n                      contentPadding: EdgeInsets.zero,\n                    ),\n                    onTap: () {\n                      Future.delayed(const Duration(milliseconds: 100), () {\n                        _showDeleteConfirmation(location);\n                      });\n                    },\n                  ),\n                ],\n              ),\n            ),\n          );\n        },\n      ),\n      floatingActionButton: FloatingActionButton.extended(\n        onPressed: _showAddDialog,\n        icon: const Icon(Icons.add),\n        label: const Text('Add Location'),\n      ),\n    );\n  }\n\n  void _showBlockDialog(DeliveryLocation location) {\n    final reasonController = TextEditingController();\n\n    showDialog(\n      context: context,\n      builder: (context) => AlertDialog(\n        title: const Text('Block Location'),\n        content: Column(\n          mainAxisSize: MainAxisSize.min,\n          children: [\n            Text('Block deliveries to ${location.name}?'),\n            const SizedBox(height: 16),\n            TextField(\n              controller: reasonController,\n              decoration: const InputDecoration(\n                labelText: 'Reason for blocking',\n                border: OutlineInputBorder(),\n              ),\n              maxLines: 2,\n            ),\n          ],\n        ),\n        actions: [\n          TextButton(\n            onPressed: () => Navigator.pop(context),\n            child: const Text('Cancel'),\n          ),\n          TextButton(\n            onPressed: () {\n              if (reasonController.text.isNotEmpty) {\n                setState(() {\n                  widget.locationService.blockLocation(\n                    location.id,\n                    reasonController.text,\n                  );\n                });\n                Navigator.pop(context);\n              }\n            },\n            child: const Text('Block'),\n          ),\n        ],\n      ),\n    );\n  }\n\n  void _showAddDialog() {\n    final nameController = TextEditingController();\n    final addressController = TextEditingController();\n    final latController = TextEditingController();\n    final lngController = TextEditingController();\n\n    showDialog(\n      context: context,\n      builder: (context) => AlertDialog(\n        title: const Text('Add New Location'),\n        content: SingleChildScrollView(\n          child: Column(\n            mainAxisSize: MainAxisSize.min,\n            children: [\n              TextField(\n                controller: nameController,\n                decoration: const InputDecoration(labelText: 'Name'),\n              ),\n              TextField(\n                controller: addressController,\n                decoration: const InputDecoration(labelText: 'Address'),\n                maxLines: 2,\n              ),\n              TextField(\n                controller: latController,\n                decoration: const InputDecoration(labelText: 'Latitude'),\n                keyboardType: TextInputType.number,\n              ),\n              TextField(\n                controller: lngController,\n                decoration: const InputDecoration(labelText: 'Longitude'),\n                keyboardType: TextInputType.number,\n              ),\n            ],\n          ),\n        ),\n        actions: [\n          TextButton(\n            onPressed: () => Navigator.pop(context),\n            child: const Text('Cancel'),\n          ),\n          TextButton(\n            onPressed: () {\n              if (nameController.text.isNotEmpty &&\n                  addressController.text.isNotEmpty) {\n                final newLocation = DeliveryLocation(\n                  id: DateTime.now().millisecondsSinceEpoch.toString(),\n                  name: nameController.text,\n                  address: addressController.text,\n                  latitude: double.tryParse(latController.text) ?? 0,\n                  longitude: double.tryParse(lngController.text) ?? 0,\n                );\n                setState(() {\n                  widget.locationService.addLocation(newLocation);\n                });\n                Navigator.pop(context);\n              }\n            },\n            child: const Text('Add'),\n          ),\n        ],\n      ),\n    );\n  }\n\n  void _showEditDialog(DeliveryLocation location) {\n    final nameController = TextEditingController(text: location.name);\n    final addressController = TextEditingController(text: location.address);\n    final latController = TextEditingController(text: location.latitude.toString());\n    final lngController = TextEditingController(text: location.longitude.toString());\n\n    showDialog(\n      context: context,\n      builder: (context) => AlertDialog(\n        title: const Text('Edit Location'),\n        content: SingleChildScrollView(\n          child: Column(\n            mainAxisSize: MainAxisSize.min,\n            children: [\n              TextField(\n                controller: nameController,\n                decoration: const InputDecoration(labelText: 'Name'),\n              ),\n              TextField(\n                controller: addressController,\n                decoration: const InputDecoration(labelText: 'Address'),\n                maxLines: 2,\n              ),\n              TextField(\n                controller: latController,\n                decoration: const InputDecoration(labelText: 'Latitude'),\n                keyboardType: TextInputType.number,\n              ),\n              TextField(\n                controller: lngController,\n                decoration: const InputDecoration(labelText: 'Longitude'),\n                keyboardType: TextInputType.number,\n              ),\n            ],\n          ),\n        ),\n        actions: [\n          TextButton(\n            onPressed: () => Navigator.pop(context),\n            child: const Text('Cancel'),\n          ),\n          TextButton(\n            onPressed: () {\n              final updatedLocation = location.copyWith(\n                name: nameController.text,\n                address: addressController.text,\n                latitude: double.tryParse(latController.text) ?? location.latitude,\n                longitude: double.tryParse(lngController.text) ?? location.longitude,\n              );\n              setState(() {\n                widget.locationService.updateLocation(updatedLocation);\n              });\n              Navigator.pop(context);\n            },\n            child: const Text('Save'),\n          ),\n        ],\n      ),\n    );\n  }\n\n  void _showDeleteConfirmation(DeliveryLocation location) {\n    showDialog(\n      context: context,\n      builder: (context) => AlertDialog(\n        title: const Text('Delete Location'),\n        content: Text('Are you sure you want to delete ${location.name}?'),\n        actions: [\n          TextButton(\n            onPressed: () => Navigator.pop(context),\n            child: const Text('Cancel'),\n          ),\n          TextButton(\n            onPressed: () {\n              setState(() {\n                widget.locationService.deleteLocation(location.id);\n              });\n              Navigator.pop(context);\n            },\n            style: TextButton.styleFrom(foregroundColor: Colors.red),\n            child: const Text('Delete'),\n          ),\n        ],\n      ),\n    );\n  }\n}\n